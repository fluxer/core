# Maintainer: Ivailo Monev <xakepa10@gmail.com>

# http://www.linuxfromscratch.org/blfs/view/svn/postlfs/fuse.html

version=2.9.7
description="A library that makes it possible to implement a filesystem in a userspace program."
depends=('musl')
backup=('etc/fuse.conf')
sources=("https://github.com/libfuse/libfuse/releases/download/fuse-$version/fuse-$version.tar.gz"
        "https://github.com/libfuse/libfuse/releases/download/fuse-$version/fuse-$version.tar.gz.asc"
        'fuse.conf' 'fuse.init')
pgpkeys=('3C4E599F')

src_compile() {
    cd "$SOURCE_DIR/fuse-$version"

    ./configure --prefix=/usr \
        --libdir=/lib \
        --enable-lib \
        --enable-util \
        --disable-static
    make
}

src_install() {
    cd "$SOURCE_DIR/fuse-$version"

  make DESTDIR="$INSTALL_DIR" install

  # Remove init script
  rm -vrf "$INSTALL_DIR/etc/init.d"

  # install sample config file
  install -vDm644 "$SOURCE_DIR/fuse.conf" "$INSTALL_DIR/etc/fuse.conf"

  # remove udev rules, is in defaults rules of eudev
  rm -vrf "$INSTALL_DIR/etc/udev"

  # static device nodes are handled by eudev
  rm -vrf "$INSTALL_DIR/dev"

  install -vDm744 "$SOURCE_DIR/fuse.init" "$INSTALL_DIR/etc/init.d/fuse"
}
