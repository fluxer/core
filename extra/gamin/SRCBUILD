# Maintainer: Ivailo Monev <xakepa10@gmail.com>
# Contributor: TurkBits <turkbits@turkbits.net>

version=0.1.10
description='File and directory monitoring system defined to be a subset of the FAM (File Alteration Monitor)'
depends=('glib')
makedepends=('python')
sources=("http://www.gnome.org/~veillard/gamin/sources/gamin-$version.tar.gz"
        'fix-deprecated-const.patch'
        '18_gam_server_deadlocks.patch')

src_compile() {
    cd "$SOURCE_DIR/gamin-$version"

    # https://bugs.archlinux.org/task/33642
    patch -p1 -i "$SOURCE_DIR/18_gam_server_deadlocks.patch"

    patch -p1 -i "$SOURCE_DIR/fix-deprecated-const.patch"

    autoreconf -fi
    ./configure --prefix=/usr \
        --disable-static \
        --with-threads \
        --disable-debug-api \
        --libexecdir=/usr/lib/gamin
    make
}

src_check() {
    cd "$SOURCE_DIR/gamin-$version"
    make check
}

src_install() {
    cd "$SOURCE_DIR/gamin-$version"
    make DESTDIR="$INSTALL_DIR" install
}
