# Maintainer: Ivailo Monev <xakepa10@gmail.com>

# http://www.linuxfromscratch.org/blfs/view/svn/postlfs/cyrus-sasl.html

version=2.1.27
description="Cyrus Simple Authentication Service Layer (SASL) library"
makedepends=('openssl' 'gdbm') # 'krb5'
sources=("ftp://ftp.cyrusimap.org/cyrus-sasl/cyrus-sasl-$version.tar.gz"
        'cyrus-sasl-2.1.27-as_needed.patch'
        'saslauthd.rc' 'saslauthd.confd' 'saslauthd.tmpfiles')
src_prepare() {
    cd "$SOURCE_DIR/cyrus-sasl-$version"

    patch -Np1 -i ../cyrus-sasl-2.1.27-as_needed.patch
    autoreconf -fi
}

src_compile() {
    cd "$SOURCE_DIR/cyrus-sasl-$version"

    ./configure --prefix=/usr \
        --sysconfdir=/etc \
        --with-dblib=gdbm \
        --with-dbpath=/var/lib/sasl/sasldb2 \
        --with-saslauthd=/var/run/saslauthd \
        --enable-auth-sasldb
    make -j1
}

src_install() {
    cd "$SOURCE_DIR/cyrus-sasl-$version"
    make -j1 DESTDIR="$INSTALL_DIR" install

    # install initscripts files
    install -vDm644 "$SOURCE_DIR/saslauthd.tmpfiles" "$INSTALL_DIR/etc/tmpfiles.d/saslauthd.conf"
    install -vDm744 "$SOURCE_DIR/saslauthd.rc" "$INSTALL_DIR/etc/rc.d/saslauthd"
    install -vDm644 "$SOURCE_DIR/saslauthd.confd" "$INSTALL_DIR/etc/conf.d/saslauthd"
}

