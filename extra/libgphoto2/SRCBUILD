version=2.5.10
description="The core library of gphoto2, designed to allow access to digital camera by external programs."
depends=('libexif' 'libjpeg-turbo' 'gd' 'libtool' 'libusbx')
sources=("http://downloads.sf.net/gphoto/libgphoto2-$version.tar.bz2"
        "http://downloads.sf.net/gphoto/libgphoto2-$version.tar.bz2.asc")
pgpkeys=('7C4AFD61D8AAE7570796A5172209D6902F969C95')

src_compile() {
    cd "$SOURCE_DIR/libgphoto2-$version"
    ./configure --prefix=/usr \
        --disable-rpath
    make
}

src_install() {
    cd "$SOURCE_DIR/libgphoto2-$version"

    make DESTDIR="$INSTALL_DIR" install

    # Remove unused udev helper
    rm -vrf "$INSTALL_DIR/lib/udev"

    install -vdm755 "$INSTALL_DIR/lib/udev/hwdb.d"
    LD_LIBRARY_PATH="$INSTALL_DIR/usr/lib${LD_LIBRARY_PATH:+:}$LD_LIBRARY_PATH" \
    CAMLIBS="$INSTALL_DIR/usr/lib/libgphoto2/$version" \
        "$INSTALL_DIR/usr/lib/libgphoto2/print-camera-list" hwdb > \
        "$INSTALL_DIR/lib/udev/hwdb.d/20-gphoto.hwdb"

    # Remove recursive symlink
    rm -vf "$INSTALL_DIR/usr/include/gphoto2/gphoto2"
}
