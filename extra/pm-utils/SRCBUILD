# Maintainer: Ivailo Monev <xakepa10@gmail.com>

# http://www.linuxfromscratch.org/blfs/view/svn/general/pm-utils.html

version=1.4.1
description="Utilities and scripts for suspend and hibernate power management"
depends=('bash' 'busybox' 'pm-quirks')
makedepends=('xmlto' 'docbook-xml' 'docbook-xsl')
sources=("http://pm-utils.freedesktop.org/releases/pm-utils-$version.tar.gz"
        '02-logging-append.patch'
        '12-fix-intel-audio-powersave-hook.patch'
        '13-49bluetooth-sync.patch'
        '14-disable-sata-alpm.patch')

src_compile() {
    cd "$SOURCE_DIR/pm-utils-$version"

    patch -Np1 -i "$SOURCE_DIR/02-logging-append.patch"
    patch -Np1 -i "$SOURCE_DIR/12-fix-intel-audio-powersave-hook.patch"
    patch -Np1 -i "$SOURCE_DIR/13-49bluetooth-sync.patch"
    patch -Np1 -i "$SOURCE_DIR/14-disable-sata-alpm.patch"

    ./configure --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var
    make
}

src_install() {
    cd "$SOURCE_DIR/pm-utils-$version"

    make DESTDIR="$INSTALL_DIR" install

    # nm >=0.8.2 has native udev suspend/resume support
    rm -vf "$INSTALL_DIR/usr/lib/pm-utils/sleep.d/55NetworkManager"

    # Remove hooks that cause hardware failure or don't make sense at all
    rm -vf "$INSTALL_DIR/usr/lib/pm-utils/power.d/"{harddrive,disable_wol}
}
