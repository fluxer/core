# Maintainer: Ivailo Monev <xakepa10@gmail.com>

version=20190517
description='C++ toolkit derived from the Qt 4.8 framework'
depends=('libtiff' 'libpng' 'libmng' 'libjpeg-turbo' 'sqlite' 'ca-certificates'
        'dbus' 'fontconfig' 'xorg-libraries' 'hicolor-icon-theme' 'cups' 'pcre'
        'zstd')
makedepends=('python' 'xorg-protocol-headers')
optdepends=('mariadb' 'unixodbc' 'postgresql')
sources=("https://github.com/fluxer/katie.git")

export CFLAGS="$CFLAGS -Ofast -flto" CXXFLAGS="$CXXFLAGS -Ofast -flto"

src_compile() {
    mkdir -p build && cd build

    cmake ../katie.git \
         -Wno-dev \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DKATIE_SETTINGS_FULL=/etc/xdg \
        -DKATIE_LDCONF_FULL=/etc/ld.so.conf.d \
        -DKATIE_PROFILE_FULL=/etc/profile.d \
        -DWITH_MYSQL=$OPTIONAL_MARIADB_BOOL \
        -DWITH_ODBC=$OPTIONAL_UNIXODBC_BOOL \
        -DWITH_PSQL=$OPTIONAL_POSTGRESQL_BOOL \
        -DKATIE_ALLINONE=OFF
    make
}

src_install() {
    cd "$SOURCE_DIR/build"
    make DESTDIR="$INSTALL_DIR" install
}

